<!DOCTYPE html>
<html lang="en">
<head>

</head>
<body>
<main>

    <h2>Create New Password</h2>
    <div>   
        
        <div class="col-sm col-md-4">    
            <form name="changePassword" id="user-register">
                <div class="form-group">
                    <label for="email">Email address</label>
                    <input type="email" class="form-control" id="email" name="email" value="wmitty@email.com" required>
                </div>
                <!--<button>Click here to send an email with a code</button> currently submits form-->
                <div >
                    <label for="codeID">Enter the code sent to your email</label> 
                    <input type="code" class="form-control" id="codeID" name="code" value="1234" readonly>
                </div> 
                <div >
                    <label for="passwordID">New Password</label> 
                    <input type="password" class="form-control" id="passwordID" name="password" value="password" required>
                </div> 
                <div >
                    <label for="reenterPasswordID">Re-Enter New Password</label> 
                    <input type="reenterPassword" class="form-control" id="reenterPasswordID" name="reenterPassword" value="password" required>
                </div>   
                <div>
                    <input type='submit' id="submitNewPasswordBtn" value="Login">
                </div>
                <div id="message">

                </div>
            </form>

        </div> 
    </div>   
    


</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <script src="custom-js/custom.js"></script>   
    <script src="custom-js/login.js"></script> 
    <script>
        const messageDiv = document.getElementById('message');
        const cartCount = sessionStorage.getItem('cartCount');
        let cart = document.getElementById('cartCount');
        cart.textContent = cartCount;
        const loginButton = document.getElementById('submitNewPasswordBtn');
        loginButton.addEventListener('click', emailValid);
        

        function emailValid(){
            messageDiv.innerHTML = "";
            let isValid = false;
            if (email.value.includes("@")){
                isValid = true;
                
                comparePasswords();
            }
            else{
                isValid = false;
            }
        }

        function comparePasswords(){
            event.preventDefault();
            

            if (passwordID.value == reenterPasswordID.value){
                messageDiv.innerHTML = "";
                const successMessage = document.createElement('p');
                successMessage.innerHTML = "Password reset";
                messageDiv.appendChild(successMessage);
                setJSON();
            }
            else{
                messageDiv.innerHTML = "";
                const failMessage = document.createElement('p');
                failMessage.innerHTML = "Passwords do not match. Try again";
                messageDiv.appendChild(failMessage);
            }
        }

        function setJSON(){
            const email = document.getElementById('email');
            const emailValue = email.value;
            const password = document.getElementById('passwordID');
            const passwordDetails = password.value;
            const userLoginDetails = 
            {
                "email":emailValue,
                "password":passwordDetails 
            }

            localStorage.setItem("loginDetails", JSON.stringify(userLoginDetails));

        }

    </script> 

    
    
</body>
</html>